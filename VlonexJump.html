<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vlonex Jump</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #ffffff;
            background-image: 
                linear-gradient(#cce0ff 1px, transparent 1px),
                linear-gradient(90deg, #cce0ff 1px, transparent 1px);
            background-size: 30px 30px;
            font-family: 'Impact', sans-serif;
            touch-action: none;
            user-select: none;
        }

        #gameCanvas {
            display: block;
            margin: 0 auto;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        #score {
            position: absolute;
            top: 10px;
            left: 15px;
            font-size: 30px;
            color: black;
            text-shadow: 2px 2px 0px white;
        }

        #clap-btn {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 80px;
            height: 80px;
            background: orange;
            border: 3px solid black;
            border-radius: 50%;
            font-family: 'Impact';
            font-size: 20px;
            color: white;
            display: none;
            pointer-events: auto;
            box-shadow: 0 4px 0 black;
            text-shadow: 1px 1px 0 #000;
        }
        #clap-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 black;
        }

        #red-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 0, 0, 0.4);
            display: none;
            pointer-events: none;
            z-index: 5;
        }
        
        #mom-alert {
            position: absolute;
            top: 20%;
            width: 100%;
            text-align: center;
            font-size: 40px;
            color: yellow;
            text-shadow: 3px 3px 0 #000;
            display: none;
            z-index: 6;
        }

        #menu-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            pointer-events: auto;
            z-index: 10;
        }

        h1 { font-size: 50px; margin: 0; color: #333; text-transform: uppercase; line-height: 1.1; }
        .subtitle { font-size: 24px; margin: 5px 0 20px 0; color: #555; }
        p { font-size: 20px; margin: 10px 20px; }
        
        button.start-btn {
            background: #4CAF50;
            border: none;
            padding: 15px 32px;
            text-align: center;
            display: inline-block;
            font-size: 24px;
            margin: 20px 2px;
            cursor: pointer;
            font-family: 'Impact';
            color: white;
            border: 2px solid black;
            box-shadow: 3px 3px 0 #000;
        }
        button.start-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0 #000;
        }
        
        .serif-font {
            font-family: "Times New Roman", Times, serif;
            font-style: italic;
            letter-spacing: 3px;
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>
    <div id="red-screen"></div>
    <div id="mom-alert">–ñ–ò–†–ù–ê–Ø –ú–ê–ú–ê–®–ê<br>–ê–¢–ê–ö–£–ï–¢!</div>

    <div id="ui-layer">
        <div id="score">0</div>
        <button id="clap-btn">JUMP!<br><span id="clap-count">0</span></button>
    </div>

    <div id="menu-screen">
        <h1 id="title-main">VLONEX JUMP</h1>
        <div id="title-sub" class="subtitle">–ü—É—Ç—å –≤ –Ω–∏–∫—É–¥–∞</div>
        
        <div id="gameover-text" style="display:none; margin-bottom: 20px;"></div>
        <button id="start-btn-el" class="start-btn" onclick="startGame()">–í–ø–µ—Ä—ë–¥</button>
    </div>

<script>
/* 
=================================================================
   –ö–û–ù–§–ò–ì
=================================================================
*/

const CONFIG = {
    // --- –§–∏–∑–∏–∫–∞ ---
    playerEmoji: "üï∫",
    gravity: 0.15,
    jumpForce: -6.5,
    
    jetpackForce: -15,      // –û–±—ã—á–Ω—ã–π –±–∞—Å—Å
    ottForce: -35,          // OTT
    
    moveSmoothing: 0.1,
    
    // --- –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã ---
    platformWidth: 75,
    platformHeight: 15,
    minGap: 60, 
    movingSpeedStart: 1.0,
    
    // --- –°–ª–æ–∂–Ω–æ—Å—Ç—å ---
    difficultyScale: 20000,

    // --- –ë–æ–Ω—É—Å—ã (–®–∞–Ω—Å—ã: 1 –∫ X) ---
    chanceButter: 25,
    chanceClap: 30,
    chanceSoundgoodizer: 35,
    chanceBass: 50,   
    chanceOTT: 150,    
    
    // --- –ú–∞–º–∞—à–∞ ---
    momAttackChance: 100,
    momProjectileSpeed: 2.5,
    momProjectileColor: "#7a5901",
    momProjectileSize: 40,

    // --- –¢–ï–ö–°–¢–´ ---
    texts: {
        subtitles: [
            "–ü—É—Ç—å –≤ –Ω–∏–∫—É–¥–∞",
            "–ö–∞–∫ –î—É–¥–ª –î–∂–∞–º–ø, –Ω–æ –¥–ª—è –±–µ–¥–Ω—ã—Ö",
            "...–∏ –ü—Ä–æ–∫–ª—è—Ç—å–µ OTT",
            "–°–∏–º—É–ª—è—Ç–æ—Ä —Å–∫–∞–∫–∞–Ω–∏—è",
            "–ü–∞–ª–µ—Ü –í–≤–µ—Ä—Ö Edition"
        ],
        btnRetry: [
            "–ï–©–Å –†–ê–ó",
            "–†–ï–í–ê–ù–®",
            "–ü–û–ü–†–´–ì–ê–õ–ò",
            "–ó–ê–ù–û–í–û",
            "–î–ê–í–ê–ô –ï–©–Å"
        ],
        // –ë–û–ù–£–°–´ (–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ, –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ–Ω—è–µ—Ç—Å—è)
        butterSub: [
            "–ú–∞—Ñ–ª—è–Ω–æ–µ",
            "–°–ª–∏–≤–æ—á–Ω–æ–µ, 82.5%",
            "–§–∏–∑–∏–∫–∞ –≤—ã—à–ª–∞ –ø–æ–∫—É—Ä–∏—Ç—å",
            "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –ª–∞–≥–∞–µ—Ç? –ê, –Ω–µ...",
            "–ß–∏–ª–ª-–∑–æ–Ω–∞ 10 —Å–µ–∫—É–Ω–¥"
        ],
        clapSub: [
            "–û–≤–∞—Ü–∏–∏ —Ç–≤–æ–µ–º—É —Å–∫–∏–ª–ª—É",
            "+3 –ü—Ä—ã–∂–∫–∞ (–ª–µ–≥–∞–ª—å–Ω–æ)",
            "–†—É–∫–∏ –≤–≤–µ—Ä—Ö!",
            "–°–ø–∞—Å–∞–π —Å–≤–æ—é —à–∫—É—Ä—É",
            "–ê–ø–ª–æ–¥–∏—Å–º–µ–Ω—Ç—ã –∞–≤—Ç–æ—Ä—É!"
        ],
        soundSub: [
            "–î–µ–ª–∞–µ–º –∂–∏—Ä, —É–±–∏—Ä–∞–µ–º –±—Ä–∞–∫",
            "–ù–∏–∫–∞–∫–∏—Ö —è–º, —Ç–æ–ª—å–∫–æ —Ö–∏—Ç—ã",
            "–†–µ–∂–∏–º –ë–æ–≥–∞ (–≤—Ä–µ–º–µ–Ω–Ω—ã–π)",
            "–ò–¥–µ–∞–ª—å–Ω—ã–π –º–∞—Å—Ç–µ—Ä–∏–Ω–≥",
            "–ì–û–°–¢ 3228-95, –≤—Å—ë –Ω–∞–¥–µ–∂–Ω–æ"
        ],
        bassSub: [
            "–ü–æ–¥–±—Ä–æ—Å –æ—Ç –†–æ–∫–µ—Ç–º–∞–Ω–∞",
            "–°–∞–±–≤—É—Ñ–µ—Ä –≤ –±–∞–≥–∞–∂–Ω–∏–∫–µ",
            "–í—ã—Å–æ–∫–æ –ø–æ–ª–µ—Ç–µ–ª, –∫ –¥–æ–∂–¥—é",
            "–û—Å—Ç–æ—Ä–æ–∂–Ω–æ, –≥–æ—Ä—è—á–æ",
            "–≠–∫–æ–Ω–æ–º-–∫–ª–∞—Å—Å –∞–≤–∏–∞–ª–∏–Ω–∏–π"
        ],
        ottSub: [
            "–ü–ï–†–ï–ñ–ê–¢–û –í –•–õ–ê–ú–ò–ù–£",
            "–£–®–ò –í –ö–†–û–í–¨, –ü–û–õ–ï–¢ –ù–û–†–ú–ê–õ–¨–ù–´–ô",
            "–ò–õ–û–ù –ú–ê–°–ö –ü–†–û–°–ò–¢ –í–ï–†–ù–£–¢–¨ –†–ê–ö–ï–¢–£",
            "–ö–†–ê–°–ù–ê–Ø –ö–û–õ–ë–ê–°–ö–ê",
            "–ñ–ò–†–ù–Æ–©–ò–ô –ë–£–°–¢"
        ],
        
        // –ì–ï–ô–ú–û–í–ï–†–´ - –ü–ê–î–ï–ù–ò–ï
        deathFall: [
            { t: "–í–ª–æ–Ω–µ–∫—Ñ —É–ø–∞–ª –∏ —Ä–∞–∑–±–∏–ª—Å—è –≤–¥—Ä–µ–±–µ–∑–≥–∏", s: "–¢—É–¥–∞ –µ–º—É, –ª–æ—Ö—É, –∏ –¥–æ—Ä–æ–≥–∞. –ë–µ–±–µ–±–µ." },
            { t: "–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è –±–µ—Å—Å–µ—Ä–¥–µ—á–Ω–∞", s: "–ù—å—é—Ç–æ–Ω —Ç–µ–±—è –ø–µ—Ä–µ–∏–≥—Ä–∞–ª –∏ —É–Ω–∏—á—Ç–æ–∂–∏–ª." },
            { t: "–ü–æ—Ç—Ä–∞—á–µ–Ω–æ.", s: "–î–∞–∂–µ –º–æ—è –±–∞–±–∫–∞ –ª—É—á—à–µ –ø—Ä—ã–≥–∞–µ—Ç." },
            { t: "–ó–µ–º–ª—è —Ç–µ–±–µ –ø—É—Ö–æ–º", s: "–í–ª–æ–Ω–µ–∫—Ñ —Å—Ç–∞–ª –ª–µ–ø—ë—à–∫–æ–π. R.I.P." },
            { t: "–ù–µ—É–¥–∞—á–Ω–æ–µ –ø—Ä–∏–∑–µ–º–ª–µ–Ω–∏–µ", s: "–°–æ–±–µ—Ä–∏—Å—å, —Ç—Ä—è–ø–∫–∞!" }
        ],
        
        // –ì–ï–ô–ú–û–í–ï–†–´ - –ú–ê–ú–ê–®–ê (–°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ)
        deathMom: [
            { t: "–í–ª–æ–Ω–µ–∫—Ñ –Ω–µ –≤—ã–Ω–µ—Å –¥–∏–ø–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–æ—â–∏", s: "–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ–Ω –≤–æ–∑–Ω—ë—Å—Å—è –≤ —Å–∞–¥–æ–≤–æ–µ —Ç–æ–≤–∞—Ä–∏—â–µ—Å—Ç–≤–æ", epic: ", , –ú –æ —Å —Å –∞ –¥ , ," },
            { t: "–ü—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å –°–ù–¢ –≤—ã–Ω–µ—Å –ø—Ä–∏–≥–æ–≤–æ—Ä", s: "–¢—ã –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ –¥–∞—á–Ω–æ–≥–æ –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–∞. –ü–æ—Å–º–µ—Ä—Ç–Ω–æ.", epic: ", , –ú –æ —Å —Å –∞ –¥ , ," },
            { t: "–ê–ù–ù–ò–ì–ò–õ–ò–†–û–í–ê–ù –í–ï–°–û–ú", s: "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–∞ –≤ –æ–¥–Ω–æ–º —Å–Ω–∞—Ä—è–¥–µ.", epic: ", , –£ –≤ —ã , ," },
            { t: "–ñ–ò–†–ù–ê–Ø –ê–¢–ê–ö–ê –ü–†–û–®–õ–ê –£–°–ü–ï–®–ù–û", s: "–í–ª–æ–Ω–µ–∫—Ñ –Ω–µ —Å–º–æ–≥ —É–≤–µ—Ä–Ω—É—Ç—å—Å—è –æ—Ç —Ñ–∞–∫—Ç–æ–≤.", epic: ", , –ñ –∞ –ª —å , ," },
            { t: "–í–ª–æ–Ω–µ–∫—Ñ –Ω–µ –≤—ã–≤–µ–∑ –±–∞–∑–∞—Ä–∞", s: "–ê—Ç–∞–∫–∞ —Å–≤–µ—Ä—Ö—É –æ–∫–∞–∑–∞–ª–∞—Å—å —Å–ª–∏—à–∫–æ–º —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π.", epic: ", , –õ –æ —Ö , ," }
        ]
    }
};

// --- –ê–£–î–ò–û –°–ò–°–¢–ï–ú–ê ---
const audioFiles = {
    jump: 'jump.mp3',
    break: 'break.mp3',
    mom: 'mom.mp3',
    ott: 'ott.mp3',
    bass: 'bass.mp3',
    clap: 'clap.mp3',
    slow: 'butter.mp3',
    sound: 'sound.mp3',
    fall: 'fall.mp3',
    win: 'win.mp3'
};

const sounds = {};
for (let key in audioFiles) {
    let a = new Audio(audioFiles[key]);
    a.volume = 0.4;
    sounds[key] = a;
}

function playSound(name) {
    try {
        if (sounds[name]) {
            sounds[name].currentTime = 0;
            let promise = sounds[name].play();
            if (promise !== undefined) { promise.catch(error => {}); }
        }
    } catch (e) {}
}

/* 
=================================================================
   –î–í–ò–ñ–û–ö
=================================================================
*/

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const clapBtn = document.getElementById('clap-btn');
const clapCountSpan = document.getElementById('clap-count');
const menuScreen = document.getElementById('menu-screen');
const titleMain = document.getElementById('title-main');
const titleSub = document.getElementById('title-sub');
const gameOverDiv = document.getElementById('gameover-text');
const startBtnEl = document.getElementById('start-btn-el');
const redScreen = document.getElementById('red-screen');
const momAlert = document.getElementById('mom-alert');

function resize() {
    canvas.width = window.innerWidth > 600 ? 450 : window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

let gameRunning = false;
let score = 0;
let bgY = 0; 
let difficulty = 0;
let frames = 0;
let timeScale = 1.0; 
let calculatedMaxJumpHeight = 0;

let player = { x: 0, y: 0, vy: 0, width: 40, height: 40, clapCharges: 0 };
let inputX = 0;

let platforms = [];
let bonuses = [];
let particles = [];
let hazards = [];
let highestPlatformY = 0;

let soundgoodizerActive = false;
let soundgoodizerTimer = 0;
let butterTimer = 0;

function rndArr(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
}

function initGame() {
    let h = (Math.abs(CONFIG.jumpForce) * Math.abs(CONFIG.jumpForce)) / (2 * CONFIG.gravity);
    calculatedMaxJumpHeight = h;

    player.x = canvas.width / 2 - 20;
    player.y = canvas.height - 200;
    player.vy = CONFIG.jumpForce;
    player.clapCharges = 0;
    inputX = canvas.width / 2;
    
    score = 0;
    bgY = 0;
    timeScale = 1.0;
    difficulty = 0;
    soundgoodizerActive = false;
    
    platforms = [];
    bonuses = [];
    particles = [];
    hazards = [];
    
    let startP = {
        x: canvas.width / 2 - CONFIG.platformWidth / 2,
        y: canvas.height - 100,
        type: 'normal',
        vx: 0,
        broken: false,
        bounce: 0
    };
    platforms.push(startP);
    highestPlatformY = startP.y;
    
    while (highestPlatformY > -100) spawnNextPlatform();
    
    gameRunning = true;
    updateUI();
    requestAnimationFrame(gameLoop);
}

function spawnNextPlatform() {
    difficulty = Math.min(score / CONFIG.difficultyScale, 1);

    let maxSafeGap = calculatedMaxJumpHeight * 0.9;
    let currentTargetGap = CONFIG.minGap + (maxSafeGap - CONFIG.minGap) * difficulty;
    let gap = currentTargetGap + (Math.random() * 20 - 10); 
    
    if (gap > maxSafeGap) gap = maxSafeGap;
    if (gap < CONFIG.minGap) gap = CONFIG.minGap;

    let y = highestPlatformY - gap;
    highestPlatformY = y;

    let chanceWhite = 0.05 + (0.25 * difficulty);
    let chanceMoving = 0.05 + (0.25 * difficulty);
    
    let type = 'normal';
    let rand = Math.random();

    if (soundgoodizerActive) {
        type = 'normal'; 
    } else {
        if (rand < chanceWhite) type = 'white';
        else if (rand < chanceWhite + chanceMoving) type = 'moving';
    }

    let w = CONFIG.platformWidth;
    let x = Math.random() * (canvas.width - w);
    
    let p = {
        x: x,
        y: y,
        type: type,
        vx: 0,
        broken: false,
        bounce: 0
    };

    if (type === 'moving') {
        let speed = CONFIG.movingSpeedStart * (1 + difficulty); 
        p.vx = Math.random() > 0.5 ? speed : -speed;
    }

    platforms.push(p);

    if (!p.broken && Math.random() < 0.3) spawnBonus(p);
}

function spawnBonus(platform) {
    if (Math.random() < 1/CONFIG.chanceOTT) {
        bonuses.push({x: platform.x + 15, y: platform.y - 35, type: 'ott', platform: platform});
        return;
    }
    if (Math.random() < 1/CONFIG.chanceBass) {
        bonuses.push({x: platform.x + 15, y: platform.y - 30, type: 'bass', platform: platform});
        return;
    }
    if (Math.random() < 1/CONFIG.chanceSoundgoodizer) {
        bonuses.push({x: platform.x + 15, y: platform.y - 30, type: 'sound', platform: platform});
        return;
    }
    if (Math.random() < 1/CONFIG.chanceButter) {
        bonuses.push({x: platform.x + 15, y: platform.y - 30, type: 'butter', platform: platform});
        return;
    }
    if (Math.random() < 1/CONFIG.chanceClap) {
        bonuses.push({x: platform.x + 15, y: platform.y - 30, type: 'clap', platform: platform});
        return;
    }
}

function gameLoop() {
    if (!gameRunning) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    document.body.style.backgroundPositionY = bgY + "px";

    if (butterTimer > 0) {
        butterTimer--;
        if (butterTimer <= 0) timeScale = 1.0;
    }
    if (soundgoodizerTimer > 0) {
        soundgoodizerTimer--;
        if (soundgoodizerTimer <= 0) soundgoodizerActive = false;
    }

    frames++;
    if (frames % 60 === 0 && Math.random() < 1/CONFIG.momAttackChance) {
        triggerMomAttack();
    }

    let targetX = inputX - player.width / 2;
    if (targetX < -10) targetX = -10;
    if (targetX > canvas.width - player.width + 10) targetX = canvas.width - player.width + 10;
    player.x += (targetX - player.x) * CONFIG.moveSmoothing;
    
    player.vy += CONFIG.gravity * timeScale;
    player.y += player.vy * timeScale;

    let targetY = canvas.height * 0.45;
    if (player.y < targetY) {
        let diff = targetY - player.y;
        player.y = targetY;
        score += Math.floor(diff);
        
        bgY += diff * 0.2;
        
        platforms.forEach(p => p.y += diff);
        bonuses.forEach(b => b.y += diff);
        hazards.forEach(h => h.y += diff);
        highestPlatformY += diff;
    }

    for (let i = 0; i < platforms.length; i++) {
        let p = platforms[i];
        
        if (p.bounce > 0) p.bounce *= 0.8;
        if (p.bounce < 0.5) p.bounce = 0;

        if (p.type === 'moving') {
            p.x += p.vx * timeScale;
            if (p.x <= 0 || p.x + CONFIG.platformWidth >= canvas.width) p.vx *= -1;
        }

        let drawY = p.y + p.bounce;

        if (!p.broken) {
            ctx.fillStyle = getPlatformColor(p.type);
            ctx.fillRect(p.x, drawY, CONFIG.platformWidth, CONFIG.platformHeight);
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 2;
            ctx.strokeRect(p.x, drawY, CONFIG.platformWidth, CONFIG.platformHeight);
        } else {
             ctx.fillStyle = '#ddd';
             ctx.fillRect(p.x, drawY + 10, CONFIG.platformWidth, CONFIG.platformHeight);
        }

        if (player.vy > 0 && !p.broken &&
            player.x + player.width > p.x + 5 &&
            player.x < p.x + CONFIG.platformWidth - 5 &&
            player.y + player.height > p.y &&
            player.y + player.height < p.y + CONFIG.platformHeight + 15
           ) {
            player.vy = CONFIG.jumpForce;
            p.bounce = 10; 
            
            playSound('jump');
            
            if (p.type === 'white') {
                p.broken = true;
                playSound('break');
            }
        }

        if (p.y > canvas.height) {
            platforms.splice(i, 1);
            i--;
        }
    }
    
    if (highestPlatformY > -100) spawnNextPlatform();
    if (platforms.length < 3) spawnNextPlatform();

    for (let i = 0; i < bonuses.length; i++) {
        let b = bonuses[i];
        let bonusDrawY = b.y;
        if (b.platform) bonusDrawY += b.platform.bounce; 
        if (b.platform && b.platform.broken) b.y += 3 * timeScale;

        ctx.font = "25px Arial";
        let icon = "‚ùì";
        if (b.type === 'butter') icon = "üßà";
        else if (b.type === 'clap') icon = "üëè";
        else if (b.type === 'sound') icon = "üéõÔ∏è";
        else if (b.type === 'bass') icon = "‚è´";
        else if (b.type === 'ott') icon = "üöÄ";  

        ctx.fillText(icon, b.x, bonusDrawY);

        if (player.x < b.x + 30 && player.x + player.width > b.x &&
            player.y < b.y + 30 && player.y + player.height > b.y) {
            activateBonus(b.type);
            bonuses.splice(i, 1);
            i--;
        }
        if (b.y > canvas.height) { bonuses.splice(i, 1); i--; }
    }

    for (let i = 0; i < hazards.length; i++) {
        let h = hazards[i];
        h.y += CONFIG.momProjectileSpeed * timeScale;
        
        ctx.fillStyle = CONFIG.momProjectileColor;
        ctx.beginPath();
        ctx.arc(h.x, h.y, CONFIG.momProjectileSize / 2, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = '#4d3800';
        ctx.stroke();

        let dx = player.x + player.width/2 - h.x;
        let dy = player.y + player.height/2 - h.y;
        if (Math.sqrt(dx*dx + dy*dy) < 30) gameOver('mom');

        if (h.y > canvas.height) { hazards.splice(i, 1); i--; }
    }

    ctx.font = "40px Arial";
    ctx.fillText(CONFIG.playerEmoji, player.x, player.y + 35);
    if (player.vy < CONFIG.jumpForce * 1.5) ctx.fillText("üî•", player.x + 5, player.y + 55);

    for (let i = 0; i < particles.length; i++) {
        let p = particles[i];
        p.y -= 0.5; 
        p.life--;
        
        ctx.globalAlpha = Math.max(0, p.life / 90);
        ctx.fillStyle = "black";
        ctx.textAlign = "center";
        
        ctx.font = "24px Impact";
        ctx.fillText(p.text, p.x, p.y);
        
        if (p.subText) {
            ctx.font = "16px Impact";
            ctx.fillText(p.subText, p.x, p.y + 20);
        }
        
        ctx.textAlign = "start"; 
        ctx.globalAlpha = 1.0;
        if (p.life <= 0) { particles.splice(i, 1); i--; }
    }

    if (player.y > canvas.height) gameOver('fall');
    updateUI();
    requestAnimationFrame(gameLoop);
}

function getPlatformColor(type) {
    if (type === 'white') return 'white';
    if (type === 'moving') return '#90EE90';
    return '#32CD32';
}

function activateBonus(type) {
    let text = "";
    let sub = "";
    
    let px = canvas.width / 2;
    let py = canvas.height / 3;

    if (type === 'butter') {
        text = "–ú–∞—Ñ–ª–æ";
        sub = rndArr(CONFIG.texts.butterSub);
        timeScale = 0.5;
        butterTimer = 600; 
        playSound('slow');
    } else if (type === 'clap') {
        text = "–ö–ª—çÃà–ø";
        sub = rndArr(CONFIG.texts.clapSub);
        player.clapCharges = 3;
        playSound('clap');
    } else if (type === 'sound') {
        text = "–°–∞—É–Ω–¥–≥—É–¥—ñ–∑—î—Ä";
        sub = rndArr(CONFIG.texts.soundSub);
        soundgoodizerActive = true;
        soundgoodizerTimer = 1800;
        playSound('sound');
    } else if (type === 'bass') {
        text = "–ì–æ—Ñ—Ä—ñ—Ä–æ–≤–∞–Ω–Ω—ã–π BASS";
        sub = rndArr(CONFIG.texts.bassSub);
        player.vy = CONFIG.jetpackForce; 
        playSound('bass');
    } else if (type === 'ott') {
        text = "OTT";
        sub = rndArr(CONFIG.texts.ottSub);
        player.vy = CONFIG.ottForce; 
        playSound('ott');
    }
    
    particles.push({x: px, y: py, text: text, subText: sub, life: 150});
}

function triggerMomAttack() {
    playSound('mom');
    redScreen.style.display = 'block';
    momAlert.style.display = 'block';
    setTimeout(() => {
        redScreen.style.display = 'none';
        momAlert.style.display = 'none';
        if (gameRunning) {
            hazards.push({ x: Math.random() * (canvas.width - 40) + 20, y: -50 });
        }
    }, 1500);
}

window.addEventListener('mousemove', e => {
    let rect = canvas.getBoundingClientRect();
    inputX = e.clientX - rect.left;
});
window.addEventListener('touchmove', e => {
    e.preventDefault();
    let rect = canvas.getBoundingClientRect();
    inputX = e.touches[0].clientX - rect.left;
}, {passive: false});
window.addEventListener('touchstart', e => {
    let rect = canvas.getBoundingClientRect();
    inputX = e.touches[0].clientX - rect.left;
}, {passive: false});

clapBtn.addEventListener('click', doClap);
clapBtn.addEventListener('touchstart', (e) => { e.stopPropagation(); doClap(); });

function doClap() {
    if (gameRunning && player.clapCharges > 0) {
        player.vy = CONFIG.jumpForce; 
        player.clapCharges--;
        playSound('jump');
        updateUI();
    }
}

function updateUI() {
    scoreEl.innerText = score;
    if (player.clapCharges > 0) {
        clapBtn.style.display = 'block';
        clapCountSpan.innerText = player.clapCharges;
    } else {
        clapBtn.style.display = 'none';
    }
}

function gameOver(reason) {
    gameRunning = false;
    menuScreen.style.display = 'flex';
    gameOverDiv.style.display = 'block';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç—Ä–æ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞–∑–∞ (—Ä–∞–Ω–¥–æ–º –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞)
    titleSub.innerText = rndArr(CONFIG.texts.subtitles);
    
    // –ö–Ω–æ–ø–∫–∞ —Ç–µ–ø–µ—Ä—å –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ä–µ–≤–∞–Ω—à
    startBtnEl.innerText = rndArr(CONFIG.texts.btnRetry);

    let html = "";
    if (reason === 'fall') {
        playSound('fall');
        let d = rndArr(CONFIG.texts.deathFall);
        html = `<h2>${d.t}</h2><p>${d.s}</p>`;
    } else if (reason === 'mom') {
        playSound('win');
        let d = rndArr(CONFIG.texts.deathMom);
        html = `<h2>${d.t}</h2><p>${d.s}</p>`;
        if (d.epic) {
            html += `<p class="serif-font" style="font-size: 28px; margin-top:20px;">${d.epic}</p>`;
        }
    }
    gameOverDiv.innerHTML = html;
}

function startGame() {
    menuScreen.style.display = 'none';
    gameOverDiv.style.display = 'none';
    initGame();
}

// –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –∫–Ω–æ–ø–∫–∞ "–í–ø–µ—Ä—ë–¥" (—Å—Ç–∞—Ç–∏—á–Ω–æ –≤ HTML), –Ω–æ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–Ω–¥–æ–º–∏–º
titleSub.innerText = rndArr(CONFIG.texts.subtitles);

</script>
</body>
</html>