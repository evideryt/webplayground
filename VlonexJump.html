<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vlonex Jump</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #ffffff;
            background-image: 
                linear-gradient(#cce0ff 1px, transparent 1px),
                linear-gradient(90deg, #cce0ff 1px, transparent 1px);
            background-size: 30px 30px;
            background-position: -1px -1px;
            font-family: 'Impact', sans-serif;
            touch-action: none;
            user-select: none;
        }

        #gameCanvas {
            display: block;
            margin: 0 auto;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        #score {
            position: absolute;
            top: 10px;
            left: 15px;
            font-size: 30px;
            color: black;
            text-shadow: 2px 2px 0px white;
        }

        #clap-btn {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 80px;
            height: 80px;
            background: orange;
            border: 3px solid black;
            border-radius: 50%;
            font-family: 'Impact';
            font-size: 20px;
            color: white;
            display: none;
            pointer-events: auto;
            box-shadow: 0 4px 0 black;
        }
        #clap-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 black;
        }

        #red-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 0, 0, 0.4);
            display: none;
            pointer-events: none;
            z-index: 5;
        }
        
        #mom-alert {
            position: absolute;
            top: 20%;
            width: 100%;
            text-align: center;
            font-size: 40px;
            color: yellow;
            text-shadow: 3px 3px 0 #000;
            display: none;
            z-index: 6;
        }

        #menu-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            pointer-events: auto;
            z-index: 10;
        }

        h1 { font-size: 50px; margin: 0; color: #333; }
        p { font-size: 20px; margin: 10px 20px; }
        
        button.start-btn {
            background: #4CAF50;
            border: none;
            padding: 15px 32px;
            text-align: center;
            display: inline-block;
            font-size: 24px;
            margin: 20px 2px;
            cursor: pointer;
            font-family: 'Impact';
            color: white;
            border: 2px solid black;
        }
        
        .serif-font {
            font-family: "Times New Roman", Times, serif;
            font-style: italic;
            letter-spacing: 3px;
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>
    <div id="red-screen"></div>
    <div id="mom-alert">–ñ–ò–†–ù–ê–Ø –ú–ê–ú–ê–®–ê<br>–í–õ–û–ù–ï–ö–§–ê –ê–¢–ê–ö–£–ï–¢!</div>

    <div id="ui-layer">
        <div id="score">0</div>
        <button id="clap-btn">JUMP!<br><span id="clap-count">0</span></button>
    </div>

    <div id="menu-screen">
        <h1 id="title-text">Vlonex Jump</h1>
        <p id="desc-text">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–ª—å—Ü–µ–º.<br>–§–∏–∑–∏–∫–∞ –∑–∞–º–µ–¥–ª–µ–Ω–∞ –¥–ª—è –∫–∞–π—Ñ–∞.</p>
        <div id="gameover-text" style="display:none;"></div>
        <button class="start-btn" onclick="startGame()">–ü–û–ì–ù–ê–õ–ò</button>
    </div>

<script>
/* 
=================================================================
   –ö–û–ù–§–ò–ì (–ù–ê–°–¢–†–û–ô–ö–ò)
   –¢–µ–ø–µ—Ä—å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥ –ø–ª–∞–≤–Ω—ã–π –≥–µ–π–º–ø–ª–µ–π –Ω–∞ 60-120–≥—Ü
=================================================================
*/

const CONFIG = {
    // --- –§–∏–∑–∏–∫–∞ (–°–¥–µ–ª–∞–ª–∏ "–ª—É–Ω–Ω—É—é", —á—Ç–æ–±—ã –±—ã–ª–æ –ø—Ä–æ—â–µ) ---
    playerEmoji: "üï∫",
    gravity: 0.15,            // –ë—ã–ª–æ 0.4 -> —Å—Ç–∞–ª–æ –º–µ–Ω—å—à–µ (–ø–ª–∞–≤–Ω–µ–µ –ø–∞–¥–µ–Ω–∏–µ)
    jumpForce: -6.5,          // –ë—ã–ª–æ -11 -> —Å—Ç–∞–ª–æ –º–µ–Ω—å—à–µ (–Ω–æ –∏–∑-–∑–∞ –Ω–∏–∑–∫–æ–π –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏ –ø—Ä—ã–≥–∞–µ—Ç –Ω–æ—Ä–º)
    jetpackForce: -15,        // –°–∏–ª–∞ –ø—Ä—ã–∂–∫–∞ –æ—Ç –ë–∞—Å–∞
    moveSmoothing: 0.1,       // –ò–Ω–µ—Ä—Ç–Ω–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –∑–∞ –ø–∞–ª—å—Ü–µ–º (—á–µ–º –º–µ–Ω—å—à–µ, —Ç–µ–º –ø–ª–∞–≤–Ω–µ–µ)
    
    // --- –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã ---
    platformWidth: 75,
    platformHeight: 15,
    
    // –î–∏—Å—Ç–∞–Ω—Ü–∏—è —Å–ø–∞—É–Ω–∞. 
    // –í–ê–ñ–ù–û: MaxGap —Ç–µ–ø–µ—Ä—å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –∫–æ–¥–µ, 
    // —á—Ç–æ–±—ã –Ω–µ –ø—Ä–µ–≤—ã—à–∞—Ç—å 90% –≤—ã—Å–æ—Ç—ã –ø—Ä—ã–∂–∫–∞.
    minGap: 60,               // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏

    movingSpeedStart: 1.0,    // –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã –ø–æ–ª–∑–∞—é—Ç –º–µ–¥–ª–µ–Ω–Ω–µ–µ
    
    // --- –°–ª–æ–∂–Ω–æ—Å—Ç—å ---
    difficultyScale: 20000,   // –ë—ã–ª–æ 5000. –ß–µ–º –±–æ–ª—å—à–µ —á–∏—Å–ª–æ, —Ç–µ–º –ú–ï–î–õ–ï–ù–ù–ï–ï –Ω–∞—Ä–∞—Å—Ç–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å.
                              // –°–µ–π—á–∞—Å –Ω—É–∂–Ω–æ –Ω–∞–±—Ä–∞—Ç—å 20–∫ –æ—á–∫–æ–≤, —á—Ç–æ–±—ã –¥–æ–π—Ç–∏ –¥–æ –º–∞–∫—Å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.

    // --- –ë–æ–Ω—É—Å—ã (–®–∞–Ω—Å—ã: 1 –∫ X) ---
    chanceButter: 25,
    chanceClap: 15,
    chanceSoundgoodizer: 35,
    chanceBass: 50,
    
    // --- –ú–∞–º–∞—à–∞ ---
    momAttackChance: 200,     // –ß—É—Ç—å —Ä–µ–∂–µ –∞—Ç–∞–∫—É–µ—Ç (–±—ã–ª–æ 150)
    momProjectileSpeed: 2.5,  // –õ–µ—Ç–∏—Ç —á—É—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ
    momProjectileColor: "#7a5901",
    momProjectileSize: 40,

    // --- –¢–µ–∫—Å—Ç—ã ---
    texts: {
        butter: "–ú–∞—Ñ–ª–æ! (—Å–ª–æ—É-–º–æ)",
        clap: "–ö–ª—çÃà–ø! (+3 –¥–∞–±–ª –¥–∂–∞–º–ø–∞)",
        sound: "–°–∞—É–Ω–¥–≥—É–¥—ñ–∑—î—Ä! (–∫–∞–π—Ñ—É–µ–º)",
        bass: "–ì–æ—Ñ—Ä—ñ—Ä–æ–≤–∞–Ω–Ω—ã–π BASS",
        bassSub: "–æ—Ç –†–æ–∫–µ—Ç–º–∞–Ω–∞",
        deathFallTitle: "–í–ª–æ–Ω–µ–∫—Ñ —É–ø–∞–ª –∏ —Ä–∞–∑–±–∏–ª—Å—è –∫ —Ö—É—è–º —Å–æ–±–∞—á—å–∏–º",
        deathFallSub: "–¢—É–¥–∞ –µ–º—É, –ª–æ—Ö—É, –∏ –¥–æ—Ä–æ–≥–∞. –ë–µ–±–µ–±–µ.",
        deathMomTitle: "–í–ª–æ–Ω–µ–∫—Ñ –Ω–µ –≤—ã–Ω–µ—Å –¥–∏–ø–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–æ—â–∏ –º–∞–º–∞—à–∏ –∏ —Å–¥–æ—Ö",
        deathMomSub: "–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ–Ω –≤–æ–∑–Ω—ë—Å—Å—è –≤ —Å–∞–¥–æ–≤–æ–µ —Ç–æ–≤–∞—Ä–∏—â–µ—Å—Ç–≤–æ",
        deathMomEpic: ", , –ú –æ —Å —Å –∞ –¥ , ,"
    }
};

/* 
=================================================================
   –õ–û–ì–ò–ö–ê
=================================================================
*/

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const clapBtn = document.getElementById('clap-btn');
const clapCountSpan = document.getElementById('clap-count');
const menuScreen = document.getElementById('menu-screen');
const gameOverDiv = document.getElementById('gameover-text');
const redScreen = document.getElementById('red-screen');
const momAlert = document.getElementById('mom-alert');

function resize() {
    canvas.width = window.innerWidth > 600 ? 450 : window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let gameRunning = false;
let score = 0;
let cameraY = 0;
let difficulty = 0; // 0.0 - 1.0
let frames = 0;
let timeScale = 1.0; 

// –†–∞—Å—á–µ—Ç–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –ø—Ä—ã–∂–∫–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
let calculatedMaxJumpHeight = 0;

// –ò–≥—Ä–æ–∫
let player = { x: 0, y: 0, vy: 0, width: 40, height: 40, clapCharges: 0 };
let inputX = 0;

// –°–ø–∏—Å–∫–∏
let platforms = [];
let bonuses = [];
let particles = [];
let hazards = [];

// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã—Å–æ—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–ø–∞–≤–Ω–∞
let highestPlatformY = 0;

function initGame() {
    // –†–∞—Å—á–µ—Ç —Ñ–∏–∑–∏–∫–∏
    // h = v^2 / (2g)
    let h = (Math.abs(CONFIG.jumpForce) * Math.abs(CONFIG.jumpForce)) / (2 * CONFIG.gravity);
    calculatedMaxJumpHeight = h;
    console.log("Max Jump Height calculated: " + Math.floor(h) + "px");

    player.x = canvas.width / 2 - 20;
    player.y = canvas.height - 200;
    player.vy = CONFIG.jumpForce;
    player.clapCharges = 0;
    inputX = canvas.width / 2;
    
    score = 0;
    cameraY = 0;
    timeScale = 1.0;
    difficulty = 0;
    
    platforms = [];
    bonuses = [];
    particles = [];
    hazards = [];
    
    // –°—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
    let startP = {
        x: canvas.width / 2 - CONFIG.platformWidth / 2,
        y: canvas.height - 100,
        type: 'normal',
        vx: 0,
        broken: false
    };
    platforms.push(startP);
    highestPlatformY = startP.y;
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É—Ä–æ–≤–µ–Ω—å –≤–≤–µ—Ä—Ö
    while (highestPlatformY > -100) {
        spawnNextPlatform();
    }
    
    gameRunning = true;
    updateUI();
    requestAnimationFrame(gameLoop);
}

function spawnNextPlatform() {
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å
    difficulty = Math.min(score / CONFIG.difficultyScale, 1);

    // –†–∞—Å—á–µ—Ç –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ (Y)
    // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≥—ç–ø + –¥–æ–±–∞–≤–∫–∞ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
    // –ù–æ —Å—Ç—Ä–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 90% –æ—Ç –≤—ã—Å–æ—Ç—ã –ø—Ä—ã–∂–∫–∞
    let maxSafeGap = calculatedMaxJumpHeight * 0.9;
    
    // –ü–ª–∞–≤–Ω–æ–µ –Ω–∞—Ä–∞—Å—Ç–∞–Ω–∏–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏
    // –í –Ω–∞—á–∞–ª–µ (diff 0) –¥–∏—Å—Ç–∞–Ω—Ü–∏—è minGap
    // –í –∫–æ–Ω—Ü–µ (diff 1) –¥–∏—Å—Ç–∞–Ω—Ü–∏—è maxSafeGap
    let currentTargetGap = CONFIG.minGap + (maxSafeGap - CONFIG.minGap) * difficulty;
    
    // –ù–µ–º–Ω–æ–≥–æ —Ä–∞–Ω–¥–æ–º–∞, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Å–∫—É—á–Ω–æ (+/- 10%)
    let variance = (Math.random() * 20 - 10); 
    let gap = currentTargetGap + variance;
    
    // –ñ–µ—Å—Ç–∫–∏–π –∫–∞–ø: –Ω–∏ –ø—Ä–∏ –∫–∞–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ–º 90% –≤—ã—Å–æ—Ç—ã –ø—Ä—ã–∂–∫–∞
    if (gap > maxSafeGap) gap = maxSafeGap;
    if (gap < CONFIG.minGap) gap = CONFIG.minGap;

    let y = highestPlatformY - gap;
    highestPlatformY = y;

    // –¢–∏–ø –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
    // –ë–µ–ª—ã–µ (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ): –º–∞–∫—Å 30%
    let chanceWhite = 0.05 + (0.25 * difficulty);
    // –î–≤–∏–∂—É—â–∏–µ—Å—è: –º–∞–∫—Å 30%
    let chanceMoving = 0.05 + (0.25 * difficulty);
    
    let type = 'normal';
    let rand = Math.random();

    if (soundgoodizerActive) {
        if (rand < 0.5) type = 'normal';
        else type = 'moving';
    } else {
        if (rand < chanceWhite) type = 'white';
        else if (rand < chanceWhite + chanceMoving) type = 'moving';
    }

    // –ü–æ–∑–∏—Ü–∏—è X
    let w = CONFIG.platformWidth;
    let x = Math.random() * (canvas.width - w);
    
    let p = {
        x: x,
        y: y,
        type: type,
        vx: 0,
        broken: false
    };

    if (type === 'moving') {
        let speed = CONFIG.movingSpeedStart * (1 + difficulty); // –°–∫–æ—Ä–æ—Å—Ç—å —Ä–∞—Å—Ç–µ—Ç –≤—Å–µ–≥–æ –≤ 2 —Ä–∞–∑–∞ –∫ —Ñ–∏–Ω–∞–ª—É
        p.vx = Math.random() > 0.5 ? speed : -speed;
    }

    platforms.push(p);

    // –ë–æ–Ω—É—Å?
    if (!p.broken && Math.random() < 0.3) {
        spawnBonus(p);
    }
}

function spawnBonus(platform) {
    if (Math.random() < 1/CONFIG.chanceBass) {
        bonuses.push({x: platform.x + 15, y: platform.y - 30, type: 'bass', platform: platform});
        return;
    }
    if (Math.random() < 1/CONFIG.chanceSoundgoodizer) {
        bonuses.push({x: platform.x + 15, y: platform.y - 30, type: 'sound', platform: platform});
        return;
    }
    if (Math.random() < 1/CONFIG.chanceButter) {
        bonuses.push({x: platform.x + 15, y: platform.y - 30, type: 'butter', platform: platform});
        return;
    }
    if (Math.random() < 1/CONFIG.chanceClap) {
        bonuses.push({x: platform.x + 15, y: platform.y - 30, type: 'clap', platform: platform});
        return;
    }
}

// –¢–∞–π–º–µ—Ä—ã —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
let soundgoodizerActive = false;
let soundgoodizerTimer = 0;
let butterTimer = 0;

function gameLoop() {
    if (!gameRunning) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // –õ–æ–≥–∏–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    if (butterTimer > 0) {
        butterTimer--;
        if (butterTimer <= 0) timeScale = 1.0;
    }
    if (soundgoodizerTimer > 0) {
        soundgoodizerTimer--;
        if (soundgoodizerTimer <= 0) soundgoodizerActive = false;
    }

    // –ú–∞–º–∞—à–∞
    frames++;
    if (frames % 60 === 0 && Math.random() < 1/CONFIG.momAttackChance) {
        triggerMomAttack();
    }

    // --- –ò–≥—Ä–æ–∫ ---
    let targetX = inputX - player.width / 2;
    // –ú—è–≥–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫—Ä–∞–µ–≤
    if (targetX < -10) targetX = -10;
    if (targetX > canvas.width - player.width + 10) targetX = canvas.width - player.width + 10;
    
    player.x += (targetX - player.x) * CONFIG.moveSmoothing;
    
    // –§–∏–∑–∏–∫–∞
    player.vy += CONFIG.gravity * timeScale;
    player.y += player.vy * timeScale;

    // –°–∫—Ä–æ–ª–ª –º–∏—Ä–∞
    let targetY = canvas.height * 0.45; // –ß—É—Ç—å –Ω–∏–∂–µ —Å–µ—Ä–µ–¥–∏–Ω—ã –¥–µ—Ä–∂–∏–º
    if (player.y < targetY) {
        let diff = targetY - player.y;
        player.y = targetY;
        score += Math.floor(diff);
        
        platforms.forEach(p => p.y += diff);
        bonuses.forEach(b => b.y += diff);
        particles.forEach(p => p.y += diff);
        hazards.forEach(h => h.y += diff);
        
        highestPlatformY += diff; // –°–¥–≤–∏–≥–∞–µ–º —Ç–æ—á–∫—É —Å–ø–∞—É–Ω–∞
    }

    // –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã
    for (let i = 0; i < platforms.length; i++) {
        let p = platforms[i];
        
        if (p.type === 'moving') {
            p.x += p.vx * timeScale;
            if (p.x <= 0 || p.x + CONFIG.platformWidth >= canvas.width) p.vx *= -1;
        }

        // –†–µ–Ω–¥–µ—Ä
        if (!p.broken) {
            ctx.fillStyle = getPlatformColor(p.type);
            ctx.fillRect(p.x, p.y, CONFIG.platformWidth, CONFIG.platformHeight);
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 2;
            ctx.strokeRect(p.x, p.y, CONFIG.platformWidth, CONFIG.platformHeight);
        } else {
             ctx.fillStyle = '#ddd';
             ctx.fillRect(p.x, p.y + 10, CONFIG.platformWidth, CONFIG.platformHeight);
        }

        // –ö–æ–ª–ª–∏–∑–∏—è
        if (player.vy > 0 && !p.broken &&
            player.x + player.width > p.x + 5 && // –ß—É—Ç—å —É–∂–µ —Ö–∏—Ç–±–æ–∫—Å –¥–ª—è —á–µ—Å—Ç–Ω–æ—Å—Ç–∏
            player.x < p.x + CONFIG.platformWidth - 5 &&
            player.y + player.height > p.y &&
            player.y + player.height < p.y + CONFIG.platformHeight + 15
           ) {
            player.vy = CONFIG.jumpForce;
            if (p.type === 'white') p.broken = true;
        }

        // –†–µ—Å–∞–π–∫–ª
        if (p.y > canvas.height) {
            platforms.splice(i, 1);
            i--;
        }
    }
    
    // –î–æ—Å–ø–∞—É–Ω
    // –ï—Å–ª–∏ –≤–µ—Ä—Ö–Ω—è—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —É–µ—Ö–∞–ª–∞ –Ω–∏–∂–µ -100, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é
    if (highestPlatformY > -100) {
        spawnNextPlatform();
    }
    
    // –ë–∞–≥—Ñ–∏–∫—Å: –µ—Å–ª–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º —Å–æ–≤—Å–µ–º –Ω–µ—Ç (—É–ø–∞–ª–∏ –≤—Å–µ –±–µ–ª—ã–µ?)
    if (platforms.length < 3) {
        let y = highestPlatformY; 
        if (platforms.length > 0) {
            y = Math.min(...platforms.map(pl => pl.y));
            highestPlatformY = y;
        } 
        spawnNextPlatform();
    }

    // –ë–æ–Ω—É—Å—ã
    for (let i = 0; i < bonuses.length; i++) {
        let b = bonuses[i];
        if (b.platform && b.platform.broken) b.y += 3 * timeScale;

        ctx.font = "25px Arial";
        let icon = b.type === 'butter' ? "üßà" : b.type === 'clap' ? "üëè" : b.type === 'sound' ? "üéõÔ∏è" : "üöÄ";
        ctx.fillText(icon, b.x, b.y);

        if (player.x < b.x + 30 && player.x + player.width > b.x &&
            player.y < b.y + 30 && player.y + player.height > b.y) {
            activateBonus(b.type);
            bonuses.splice(i, 1);
            i--;
        }
        if (b.y > canvas.height) { bonuses.splice(i, 1); i--; }
    }

    // –ú–∞–º–∞—à–∞
    for (let i = 0; i < hazards.length; i++) {
        let h = hazards[i];
        h.y += CONFIG.momProjectileSpeed * timeScale;
        
        ctx.fillStyle = CONFIG.momProjectileColor;
        ctx.beginPath();
        ctx.arc(h.x, h.y, CONFIG.momProjectileSize / 2, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = '#4d3800';
        ctx.stroke();

        let dx = player.x + player.width/2 - h.x;
        let dy = player.y + player.height/2 - h.y;
        if (Math.sqrt(dx*dx + dy*dy) < 30) gameOver('mom');

        if (h.y > canvas.height) { hazards.splice(i, 1); i--; }
    }

    // –ò–≥—Ä–æ–∫
    ctx.font = "40px Arial";
    ctx.fillText(CONFIG.playerEmoji, player.x, player.y + 35);
    if (player.vy < CONFIG.jumpForce * 1.5) ctx.fillText("üî•", player.x + 5, player.y + 55);

    // –ü–∞—Ä—Ç–∏–∫–ª—ã
    for (let i = 0; i < particles.length; i++) {
        let p = particles[i];
        p.y -= 1 * timeScale;
        p.life--;
        ctx.globalAlpha = Math.max(0, p.life / 60);
        ctx.fillStyle = "black";
        ctx.font = "20px Impact";
        ctx.fillText(p.text, p.x, p.y);
        if (p.subText) {
            ctx.font = "14px Impact";
            ctx.fillText(p.subText, p.x, p.y + 15);
        }
        ctx.globalAlpha = 1.0;
        if (p.life <= 0) { particles.splice(i, 1); i--; }
    }

    if (player.y > canvas.height) gameOver('fall');
    
    updateUI();
    requestAnimationFrame(gameLoop);
}

function getPlatformColor(type) {
    if (type === 'white') return 'white';
    if (type === 'moving') return '#90EE90';
    return '#32CD32';
}

function activateBonus(type) {
    let text = "";
    let sub = "";
    if (type === 'butter') {
        text = CONFIG.texts.butter;
        timeScale = 0.5;
        butterTimer = 600; 
    } else if (type === 'clap') {
        text = CONFIG.texts.clap;
        player.clapCharges = 3;
    } else if (type === 'sound') {
        text = CONFIG.texts.sound;
        soundgoodizerActive = true;
        soundgoodizerTimer = 1800; 
    } else if (type === 'bass') {
        text = CONFIG.texts.bass;
        sub = CONFIG.texts.bassSub;
        player.vy = CONFIG.jetpackForce; 
    }
    particles.push({x: player.x - 20, y: player.y - 20, text: text, subText: sub, life: 120});
}

function triggerMomAttack() {
    redScreen.style.display = 'block';
    momAlert.style.display = 'block';
    setTimeout(() => {
        redScreen.style.display = 'none';
        momAlert.style.display = 'none';
        if (gameRunning) {
            hazards.push({ x: Math.random() * (canvas.width - 40) + 20, y: -50 });
        }
    }, 1500);
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
window.addEventListener('mousemove', e => {
    let rect = canvas.getBoundingClientRect();
    inputX = e.clientX - rect.left;
});
window.addEventListener('touchmove', e => {
    e.preventDefault();
    let rect = canvas.getBoundingClientRect();
    inputX = e.touches[0].clientX - rect.left;
}, {passive: false});
window.addEventListener('touchstart', e => {
    let rect = canvas.getBoundingClientRect();
    inputX = e.touches[0].clientX - rect.left;
}, {passive: false});

clapBtn.addEventListener('touchstart', (e) => {
    e.stopPropagation();
    if (gameRunning && player.clapCharges > 0) {
        player.vy = CONFIG.jumpForce; 
        player.clapCharges--;
        updateUI();
    }
});
clapBtn.addEventListener('click', () => {
    if (gameRunning && player.clapCharges > 0) {
        player.vy = CONFIG.jumpForce; 
        player.clapCharges--;
        updateUI();
    }
});

function updateUI() {
    scoreEl.innerText = score;
    if (player.clapCharges > 0) {
        clapBtn.style.display = 'block';
        clapCountSpan.innerText = player.clapCharges;
    } else {
        clapBtn.style.display = 'none';
    }
}

function gameOver(reason) {
    gameRunning = false;
    menuScreen.style.display = 'flex';
    gameOverDiv.style.display = 'block';
    let html = "";
    if (reason === 'fall') {
        html = `<h2>${CONFIG.texts.deathFallTitle}</h2><p>${CONFIG.texts.deathFallSub}</p>`;
    } else if (reason === 'mom') {
        html = `<h2>${CONFIG.texts.deathMomTitle}</h2><p>${CONFIG.texts.deathMomSub}</p><p class="serif-font" style="font-size: 28px; margin-top:20px;">${CONFIG.texts.deathMomEpic}</p>`;
    }
    gameOverDiv.innerHTML = html;
}

function startGame() {
    menuScreen.style.display = 'none';
    gameOverDiv.style.display = 'none';
    initGame();
}
</script>
</body>
</html>
