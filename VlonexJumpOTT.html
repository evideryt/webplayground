<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vlonex Jump: OTT Edition</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #ffffff;
            /* –§–æ–Ω –∑–∞–¥–∞–µ–º —á–µ—Ä–µ–∑ JS –¥–ª—è –ø–∞—Ä–∞–ª–ª–∞–∫—Å–∞ */
            background-image: 
                linear-gradient(#cce0ff 1px, transparent 1px),
                linear-gradient(90deg, #cce0ff 1px, transparent 1px);
            background-size: 30px 30px;
            font-family: 'Impact', sans-serif;
            touch-action: none;
            user-select: none;
        }

        #gameCanvas {
            display: block;
            margin: 0 auto;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        #score {
            position: absolute;
            top: 10px;
            left: 15px;
            font-size: 30px;
            color: black;
            text-shadow: 2px 2px 0px white;
        }

        /* –ö–Ω–æ–ø–∫–∞ –¥–≤–æ–π–Ω–æ–≥–æ –ø—Ä—ã–∂–∫–∞ */
        #clap-btn {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 80px;
            height: 80px;
            background: orange;
            border: 3px solid black;
            border-radius: 50%;
            font-family: 'Impact';
            font-size: 20px;
            color: white;
            display: none;
            pointer-events: auto;
            box-shadow: 0 4px 0 black;
            text-shadow: 1px 1px 0 #000;
        }
        #clap-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 black;
        }

        #red-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 0, 0, 0.4);
            display: none;
            pointer-events: none;
            z-index: 5;
        }
        
        #mom-alert {
            position: absolute;
            top: 20%;
            width: 100%;
            text-align: center;
            font-size: 40px;
            color: yellow;
            text-shadow: 3px 3px 0 #000;
            display: none;
            z-index: 6;
        }

        #menu-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            pointer-events: auto;
            z-index: 10;
        }

        h1 { font-size: 50px; margin: 0; color: #333; text-transform: uppercase;}
        p { font-size: 20px; margin: 10px 20px; }
        
        button.start-btn {
            background: #4CAF50;
            border: none;
            padding: 15px 32px;
            text-align: center;
            display: inline-block;
            font-size: 24px;
            margin: 20px 2px;
            cursor: pointer;
            font-family: 'Impact';
            color: white;
            border: 2px solid black;
            box-shadow: 3px 3px 0 #000;
        }
        button.start-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0 #000;
        }
        
        .serif-font {
            font-family: "Times New Roman", Times, serif;
            font-style: italic;
            letter-spacing: 3px;
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>
    <div id="red-screen"></div>
    <div id="mom-alert">–ñ–ò–†–ù–ê–Ø –ú–ê–ú–ê–®–ê<br>–ê–¢–ê–ö–£–ï–¢!</div>

    <div id="ui-layer">
        <div id="score">0</div>
        <button id="clap-btn">JUMP!<br><span id="clap-count">0</span></button>
    </div>

    <div id="menu-screen">
        <h1 id="title-text">VLONEX JUMP</h1>
        <p id="desc-text">OTT EDITION</p>
        <div id="gameover-text" style="display:none; margin-bottom: 20px;"></div>
        <button id="start-btn-el" class="start-btn" onclick="startGame()">–ü–û–ì–ù–ê–õ–ò</button>
    </div>

<script>
/* 
=================================================================
   –ö–û–ù–§–ò–ì (–ú–ï–ú–ù–´–ô –°–ö–õ–ê–î)
=================================================================
*/

const CONFIG = {
    // --- –§–∏–∑–∏–∫–∞ ---
    playerEmoji: "üï∫",
    gravity: 0.15,
    jumpForce: -6.5,
    
    jetpackForce: -15,      // –û–±—ã—á–Ω—ã–π –±–∞—Å—Å
    ottForce: -35,          // OTT (–í 5 —Ä–∞–∑ –º–æ—â–Ω–µ–µ –æ–±—ã—á–Ω–æ–≥–æ –ø—Ä—ã–∂–∫–∞, –ø–æ—á—Ç–∏ —Ç–µ–ª–µ–ø–æ—Ä—Ç)
    
    moveSmoothing: 0.1,
    
    // --- –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã ---
    platformWidth: 75,
    platformHeight: 15,
    minGap: 60, 
    movingSpeedStart: 1.0,
    
    // --- –°–ª–æ–∂–Ω–æ—Å—Ç—å ---
    difficultyScale: 20000,

    // --- –ë–æ–Ω—É—Å—ã (–®–∞–Ω—Å—ã: 1 –∫ X) ---
    chanceButter: 50,
    chanceClap: 30,
    chanceSoundgoodizer: 70,
    chanceBass: 100,   // –û–±—ã—á–Ω—ã–π –±–∞—Å—Å (—Ç–µ–ø–µ—Ä—å —Ä–µ–∂–µ)
    chanceOTT: 300,    // OTT (–≤ 3 —Ä–∞–∑–∞ —Ä–µ–∂–µ –±–∞—Å—Å–∞)
    
    // --- –ú–∞–º–∞—à–∞ ---
    momAttackChance: 200,
    momProjectileSpeed: 2.5,
    momProjectileColor: "#7a5901",
    momProjectileSize: 40,

    // --- –¢–ï–ö–°–¢–´ (–†–ê–ù–î–û–ú–ê–ô–ó–ï–†) ---
    texts: {
        intro: [
            "Vlonex Jump: –ü–∞–ª–µ—Ü –í–≤–µ—Ä—Ö",
            "–°–∏–º—É–ª—è—Ç–æ—Ä –ü—Ä—ã–∂–∫–∞ –≤ –°–∞–¥–æ–≤–æ–¥—Å—Ç–≤–æ",
            "–ù–µ —É–ø–∞–¥–∏, –±—Ä–æ",
            "Doodle Jump –¥–ª—è –ø–∞—Ü–∞–Ω–æ–≤",
            "–ü—Ä—ã–≥–∞–π –∏–ª–∏ –±—É–¥—å —É–Ω–∏–∂–µ–Ω"
        ],
        btnStart: [
            "–ü–û–ì–ù–ê–õ–ò –Å–ü–¢–ê",
            "LFG (Lets Fucking Go)",
            "–í –ü–£–¢–¨",
            "–ü–†–´–ì –°–ö–û–ö",
            "–ù–ê–ñ–ú–ò –ú–ï–ù–Ø"
        ],
        butter: [
            "–ú–∞—Ñ–ª–æ! (–≤—è–∑–∫–æ)",
            "–°–ª–æ—É-–º–æ –¥–ª—è —ç–ª–∏—Ç—ã",
            "–¢–æ—Ä–º–æ–∑–∏–º, –ø–∞—Ü–∞–Ω—ã",
            "–ß–∏–ª–ª-–∑–æ–Ω–∞ 10 —Å–µ–∫",
            "–°–ª–∏–≤–æ—á–Ω–æ–µ, 82.5%"
        ],
        clap: [
            "–ö–ª—çÃà–ø! (—Ö–ª–æ–ø-—Ö–ª–æ–ø)",
            "+3 –ü—Ä—ã–∂–∫–∞ (–ª–µ–≥–∞–ª—å–Ω–æ)",
            "–î–∞–±–ª-–¥–∂–∞–º–ø —á–µ–∫",
            "–†—É–∫–∏ –≤–≤–µ—Ä—Ö!",
            "–ê–ø–ª–æ–¥–∏—Å–º–µ–Ω—Ç—ã –∞–≤—Ç–æ—Ä—É"
        ],
        sound: [
            "–°–∞—É–Ω–¥–≥—É–¥—ñ–∑—î—Ä! (—Ä–æ–≤–Ω—è–µ–º)",
            "–ò–¥–µ–∞–ª—å–Ω—ã–π –º–∏–∫—Å",
            "–ë–µ–∑ —è–º –∏ –∫–æ—á–µ–∫",
            "–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–ª—è –ª—é–¥–µ–π",
            "–ñ–∏—Ä–Ω–µ–Ω—å–∫–æ –Ω–∞–º–∞–∑–∞–ª"
        ],
        bass: [
            "–ì–æ—Ñ—Ä—ñ—Ä–æ–≤–∞–Ω–Ω—ã–π BASS",
            "–ü–æ–¥–±—Ä–æ—Å –æ—Ç –†–æ–∫–µ—Ç–º–∞–Ω–∞",
            "–ß—É—Ç—å-—á—É—Ç—å –ø–æ–ª–µ—Ç–∞–ª–∏",
            "–ë–∞—Å—Å–æ—á–µ–∫",
            "–ù–∞–¥–¥—É–≤ –≤–∫–ª—é—á–µ–Ω"
        ],
        ott: [
            "OTT: –ñ–ò–†–ù–Æ–©–ò–ô –ë–ê–°–°–ë–£–°–¢",
            "–ü–ï–†–ï–ì–†–£–ó –ü–û –í–ï–†–•–ê–ú",
            "–£–õ–ï–¢–ê–ï–ú –í –°–¢–†–ê–¢–û–°–§–ï–†–£",
            "–ö–†–ê–°–ù–ê–Ø –ö–û–õ–ë–ê–°–ö–ê",
            "–ö–û–ú–ü–†–ï–°–°–ò–Ø 1000%"
        ],
        deathFallTitle: [
            "–í–ª–æ–Ω–µ–∫—Ñ —É–ø–∞–ª –∏ —Ä–∞–∑–±–∏–ª—Å—è –∫ —Ö—É—è–º",
            "–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è –±–µ—Å—Å–µ—Ä–¥–µ—á–Ω–∞",
            "–ó–µ–º–ª—è —Ç–µ–±–µ –ø—É—Ö–æ–º, –±—Ä–∞—Ç–æ–∫",
            "–ù—É —Ç—ã –∏ –≤—ã–¥–∞–ª...",
            "–ü–æ—Ç—Ä–∞—á–µ–Ω–æ."
        ],
        deathFallSub: [
            "–¢—É–¥–∞ –µ–º—É, –ª–æ—Ö—É, –∏ –¥–æ—Ä–æ–≥–∞. –ë–µ–±–µ–±–µ.",
            "–î–∞–∂–µ –º–æ—è –±–∞–±–∫–∞ –ª—É—á—à–µ –ø—Ä—ã–≥–∞–µ—Ç.",
            "–°–æ–±–µ—Ä–∏—Å—å, —Ç—Ä—è–ø–∫–∞!",
            "–ù–µ, –Ω—É —ç—Ç–æ –±–∞–Ω.",
            "F"
        ],
        deathMomTitle: [
            "–ñ–∏—Ä–Ω–∞—è –ú–∞–º–∞—à–∞ –ø–æ–±–µ–¥–∏–ª–∞",
            "–î–∏–ø–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—Å –∑–∞–¥–∞–≤–∏–ª",
            "–í–ª–æ–Ω–µ–∫—Ñ –Ω–µ –≤—ã–≤–µ–∑ –±–∞–∑–∞—Ä–∞",
            "–ê—Ç–∞–∫–∞ —Å–≤–µ—Ä—Ö—É —É—Å–ø–µ—à–Ω–∞",
            "–¢—ã –±—ã–ª —É–Ω–∏—á—Ç–æ–∂–µ–Ω –º–∞—Å—Å–æ–π"
        ],
        deathMomSub: [
            "–û–Ω –≤–æ–∑–Ω—ë—Å—Å—è –≤ —Å–∞–¥–æ–≤–æ–µ —Ç–æ–≤–∞—Ä–∏—â–µ—Å—Ç–≤–æ.",
            "–ë–æ–ª—å—à–µ –Ω–µ –∑–≤–æ–Ω–∏ —Å—é–¥–∞.",
            "–ë–µ–∑ —à–∞–Ω—Å–æ–≤ –ø—Ä–æ—Ç–∏–≤ —Ç–∞–∫–æ–π –º–∞—Å—Å—ã.",
            "Press F to pay respects.",
            "–ú–∞–º–∞—à–∞ –¥–æ–≤–æ–ª—å–Ω–∞."
        ]
    }
};

// --- –ê–£–î–ò–û –°–ò–°–¢–ï–ú–ê ---
const audioFiles = {
    jump: 'jump.ogg',       // –û–±—ã—á–Ω—ã–π –ø—Ä—ã–∂–æ–∫
    break: 'break.ogg',     // –õ–æ–º–∞–µ—Ç—Å—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
    mom: 'mom.ogg',         // –°–∏—Ä–µ–Ω–∞
    ott: 'ott.ogg',         // OTT –∑–≤—É–∫
    bass: 'bass.ogg',       // –û–±—ã—á–Ω–∞—è —Ä–∞–∫–µ—Ç–∞
    clap: 'clap.ogg',       // –ü–æ–¥–±–æ—Ä –∫–ª—ç–ø–∞
    slow: 'slow.ogg',       // –ú–∞—Å–ª–æ
    sound: 'sound.ogg',     // –°–∞—É–Ω–¥–≥—É–¥–∞–π–∑–µ—Ä
    fall: 'fall.ogg',       // –°–º–µ—Ä—Ç—å –æ—Ç –ø–∞–¥–µ–Ω–∏—è
    win: 'win.ogg'          // –°–º–µ—Ä—Ç—å –æ—Ç –º–∞–º–∞—à–∏ (—Ç–∏–ø–∞ –ø–æ–±–µ–¥–∞ –º–∞–º–∞—à–∏)
};

const sounds = {};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤—É–∫–æ–≤ —Å "–∑–∞–≥–ª—É—à–∫–æ–π" –æ—à–∏–±–æ–∫
for (let key in audioFiles) {
    let a = new Audio(audioFiles[key]);
    a.volume = 0.4;
    sounds[key] = a;
}

function playSound(name) {
    try {
        if (sounds[name]) {
            sounds[name].currentTime = 0;
            let promise = sounds[name].play();
            if (promise !== undefined) {
                promise.catch(error => {
                    // –ê–≤—Ç–æ-–ø–ª–µ–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç, –ø–æ—Ñ–∏–≥
                });
            }
        }
    } catch (e) {
        // –ò–≥–Ω–æ—Ä –æ—à–∏–±–æ–∫
    }
}


/* 
=================================================================
   –î–í–ò–ñ–û–ö
=================================================================
*/

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const clapBtn = document.getElementById('clap-btn');
const clapCountSpan = document.getElementById('clap-count');
const menuScreen = document.getElementById('menu-screen');
const titleText = document.getElementById('title-text');
const gameOverDiv = document.getElementById('gameover-text');
const startBtnEl = document.getElementById('start-btn-el');
const redScreen = document.getElementById('red-screen');
const momAlert = document.getElementById('mom-alert');

function resize() {
    canvas.width = window.innerWidth > 600 ? 450 : window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// –°–æ—Å—Ç–æ—è–Ω–∏–µ
let gameRunning = false;
let score = 0;
let bgY = 0; // –ü–∞—Ä–∞–ª–ª–∞–∫—Å —Ñ–æ–Ω–∞
let difficulty = 0;
let frames = 0;
let timeScale = 1.0; 
let calculatedMaxJumpHeight = 0;

// –ò–≥—Ä–æ–∫
let player = { x: 0, y: 0, vy: 0, width: 40, height: 40, clapCharges: 0 };
let inputX = 0;

// –û–±—ä–µ–∫—Ç—ã
let platforms = [];
let bonuses = [];
let particles = []; // –¢–µ–∫—Å—Ç—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ
let hazards = [];
let highestPlatformY = 0;

// –≠—Ñ—Ñ–µ–∫—Ç—ã
let soundgoodizerActive = false;
let soundgoodizerTimer = 0;
let butterTimer = 0;

// –•–µ–ª–ø–µ—Ä —Ä–∞–Ω–¥–æ–º–∞
function rndArr(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
}

// --- –°–¢–ê–†–¢ ---
function initGame() {
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç—ã –≤ –º–µ–Ω—é –Ω–∞ —Ä–∞–Ω–¥–æ–º–Ω—ã–µ –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ (–¥–ª—è —Å–ª–µ–¥. —Ä–∞–∑–∞)
    // –ù–æ —Å–µ–π—á–∞—Å –º—ã —É–∂–µ –Ω–∞–∂–∞–ª–∏ –∫–Ω–æ–ø–∫—É.
    
    let h = (Math.abs(CONFIG.jumpForce) * Math.abs(CONFIG.jumpForce)) / (2 * CONFIG.gravity);
    calculatedMaxJumpHeight = h;

    player.x = canvas.width / 2 - 20;
    player.y = canvas.height - 200;
    player.vy = CONFIG.jumpForce;
    player.clapCharges = 0;
    inputX = canvas.width / 2;
    
    score = 0;
    bgY = 0;
    timeScale = 1.0;
    difficulty = 0;
    soundgoodizerActive = false;
    
    platforms = [];
    bonuses = [];
    particles = [];
    hazards = [];
    
    let startP = {
        x: canvas.width / 2 - CONFIG.platformWidth / 2,
        y: canvas.height - 100,
        type: 'normal',
        vx: 0,
        broken: false,
        bounce: 0 // –î–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç–ø—Ä—É–∂–∏–Ω–∏–≤–∞–Ω–∏—è
    };
    platforms.push(startP);
    highestPlatformY = startP.y;
    
    while (highestPlatformY > -100) spawnNextPlatform();
    
    gameRunning = true;
    updateUI();
    requestAnimationFrame(gameLoop);
}

// --- –ì–ï–ù–ï–†–ê–¶–ò–Ø ---
function spawnNextPlatform() {
    difficulty = Math.min(score / CONFIG.difficultyScale, 1);

    let maxSafeGap = calculatedMaxJumpHeight * 0.9;
    let currentTargetGap = CONFIG.minGap + (maxSafeGap - CONFIG.minGap) * difficulty;
    let gap = currentTargetGap + (Math.random() * 20 - 10); 
    
    if (gap > maxSafeGap) gap = maxSafeGap;
    if (gap < CONFIG.minGap) gap = CONFIG.minGap;

    let y = highestPlatformY - gap;
    highestPlatformY = y;

    let chanceWhite = 0.05 + (0.25 * difficulty);
    let chanceMoving = 0.05 + (0.25 * difficulty);
    
    let type = 'normal';
    let rand = Math.random();

    if (soundgoodizerActive) {
        type = 'normal'; // –°–∞—É–Ω–¥–≥—É–¥–∞–π–∑–µ—Ä –æ—Ç–∫–ª—é—á–∞–µ—Ç –≤—Å—ë –ø–ª–æ—Ö–æ–µ
    } else {
        if (rand < chanceWhite) type = 'white';
        else if (rand < chanceWhite + chanceMoving) type = 'moving';
    }

    let w = CONFIG.platformWidth;
    let x = Math.random() * (canvas.width - w);
    
    let p = {
        x: x,
        y: y,
        type: type,
        vx: 0,
        broken: false,
        bounce: 0
    };

    if (type === 'moving') {
        let speed = CONFIG.movingSpeedStart * (1 + difficulty); 
        p.vx = Math.random() > 0.5 ? speed : -speed;
    }

    platforms.push(p);

    if (!p.broken && Math.random() < 0.3) spawnBonus(p);
}

function spawnBonus(platform) {
    // OTT (—Å–∞–º—ã–π —Ä–µ–¥–∫–∏–π)
    if (Math.random() < 1/CONFIG.chanceOTT) {
        bonuses.push({x: platform.x + 15, y: platform.y - 35, type: 'ott', platform: platform});
        return;
    }
    if (Math.random() < 1/CONFIG.chanceBass) {
        bonuses.push({x: platform.x + 15, y: platform.y - 30, type: 'bass', platform: platform});
        return;
    }
    if (Math.random() < 1/CONFIG.chanceSoundgoodizer) {
        bonuses.push({x: platform.x + 15, y: platform.y - 30, type: 'sound', platform: platform});
        return;
    }
    if (Math.random() < 1/CONFIG.chanceButter) {
        bonuses.push({x: platform.x + 15, y: platform.y - 30, type: 'butter', platform: platform});
        return;
    }
    if (Math.random() < 1/CONFIG.chanceClap) {
        bonuses.push({x: platform.x + 15, y: platform.y - 30, type: 'clap', platform: platform});
        return;
    }
}

// --- LOOP ---
function gameLoop() {
    if (!gameRunning) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // –ü–∞—Ä–∞–ª–ª–∞–∫—Å —Ñ–æ–Ω–∞
    document.body.style.backgroundPositionY = bgY + "px";

    if (butterTimer > 0) {
        butterTimer--;
        if (butterTimer <= 0) timeScale = 1.0;
    }
    if (soundgoodizerTimer > 0) {
        soundgoodizerTimer--;
        if (soundgoodizerTimer <= 0) soundgoodizerActive = false;
    }

    frames++;
    if (frames % 60 === 0 && Math.random() < 1/CONFIG.momAttackChance) {
        triggerMomAttack();
    }

    // –ò–≥—Ä–æ–∫ X
    let targetX = inputX - player.width / 2;
    if (targetX < -10) targetX = -10;
    if (targetX > canvas.width - player.width + 10) targetX = canvas.width - player.width + 10;
    player.x += (targetX - player.x) * CONFIG.moveSmoothing;
    
    // –ò–≥—Ä–æ–∫ Y
    player.vy += CONFIG.gravity * timeScale;
    player.y += player.vy * timeScale;

    // –ö–∞–º–µ—Ä–∞
    let targetY = canvas.height * 0.45;
    if (player.y < targetY) {
        let diff = targetY - player.y;
        player.y = targetY;
        score += Math.floor(diff);
        
        // –î–≤–∏–≥–∞–µ–º —Ñ–æ–Ω –º–µ–¥–ª–µ–Ω–Ω–µ–µ —á–µ–º –º–∏—Ä (0.2 —Å–∫–æ—Ä–æ—Å—Ç—å)
        bgY += diff * 0.2;
        
        platforms.forEach(p => p.y += diff);
        bonuses.forEach(b => b.y += diff);
        // –¢–ï–ö–°–¢–´ –ù–ï –î–í–ò–ì–ê–ï–ú, –û–ù–ò –ü–†–ò–õ–ò–ü–õ–ò –ö –≠–ö–†–ê–ù–£
        hazards.forEach(h => h.y += diff);
        
        highestPlatformY += diff;
    }

    // –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã
    for (let i = 0; i < platforms.length; i++) {
        let p = platforms[i];
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä—É–∂–∏–Ω—ã (–≤–æ–∑–≤—Ä–∞—Ç –≤ 0)
        if (p.bounce > 0) p.bounce *= 0.8;
        if (p.bounce < 0.5) p.bounce = 0;

        if (p.type === 'moving') {
            p.x += p.vx * timeScale;
            if (p.x <= 0 || p.x + CONFIG.platformWidth >= canvas.width) p.vx *= -1;
        }

        // –†–µ–Ω–¥–µ—Ä —Å —É—á–µ—Ç–æ–º –æ—Ç–ø—Ä—É–∂–∏–Ω–∏–≤–∞–Ω–∏—è (p.y + p.bounce)
        let drawY = p.y + p.bounce;

        if (!p.broken) {
            ctx.fillStyle = getPlatformColor(p.type);
            ctx.fillRect(p.x, drawY, CONFIG.platformWidth, CONFIG.platformHeight);
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 2;
            ctx.strokeRect(p.x, drawY, CONFIG.platformWidth, CONFIG.platformHeight);
        } else {
             ctx.fillStyle = '#ddd';
             ctx.fillRect(p.x, drawY + 10, CONFIG.platformWidth, CONFIG.platformHeight);
        }

        // –ö–æ–ª–ª–∏–∑–∏—è (—Å—á–∏—Ç–∞–µ–º –ø–æ —Ä–µ–∞–ª—å–Ω–æ–º—É Y, –Ω–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–º—É)
        if (player.vy > 0 && !p.broken &&
            player.x + player.width > p.x + 5 &&
            player.x < p.x + CONFIG.platformWidth - 5 &&
            player.y + player.height > p.y &&
            player.y + player.height < p.y + CONFIG.platformHeight + 15
           ) {
            player.vy = CONFIG.jumpForce;
            p.bounce = 10; // –í–∏–∑—É–∞–ª—å–Ω—ã–π –ø–∏–Ω–æ–∫ –≤–Ω–∏–∑
            
            playSound('jump');
            
            if (p.type === 'white') {
                p.broken = true;
                playSound('break');
            }
        }

        if (p.y > canvas.height) {
            platforms.splice(i, 1);
            i--;
        }
    }
    
    if (highestPlatformY > -100) spawnNextPlatform();
    if (platforms.length < 3) spawnNextPlatform();

    // –ë–æ–Ω—É—Å—ã
    for (let i = 0; i < bonuses.length; i++) {
        let b = bonuses[i];
        let bonusDrawY = b.y;
        if (b.platform) bonusDrawY += b.platform.bounce; // –ë–æ–Ω—É—Å —Ç–æ–∂–µ –ø—Ä—ã–≥–∞–µ—Ç —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π
        if (b.platform && b.platform.broken) b.y += 3 * timeScale;

        ctx.font = "25px Arial";
        let icon = "‚ùì";
        if (b.type === 'butter') icon = "üßà";
        else if (b.type === 'clap') icon = "üëè";
        else if (b.type === 'sound') icon = "üéõÔ∏è";
        else if (b.type === 'bass') icon = "‚è´"; // –ì–æ—Ñ—Ä–æ–±–∞—Å—Å
        else if (b.type === 'ott') icon = "üöÄ";   // OTT

        ctx.fillText(icon, b.x, bonusDrawY);

        if (player.x < b.x + 30 && player.x + player.width > b.x &&
            player.y < b.y + 30 && player.y + player.height > b.y) {
            activateBonus(b.type);
            bonuses.splice(i, 1);
            i--;
        }
        if (b.y > canvas.height) { bonuses.splice(i, 1); i--; }
    }

    // –û–ø–∞—Å–Ω–æ—Å—Ç–∏
    for (let i = 0; i < hazards.length; i++) {
        let h = hazards[i];
        h.y += CONFIG.momProjectileSpeed * timeScale;
        
        ctx.fillStyle = CONFIG.momProjectileColor;
        ctx.beginPath();
        ctx.arc(h.x, h.y, CONFIG.momProjectileSize / 2, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = '#4d3800';
        ctx.stroke();

        let dx = player.x + player.width/2 - h.x;
        let dy = player.y + player.height/2 - h.y;
        if (Math.sqrt(dx*dx + dy*dy) < 30) gameOver('mom');

        if (h.y > canvas.height) { hazards.splice(i, 1); i--; }
    }

    // –ò–≥—Ä–æ–∫
    ctx.font = "40px Arial";
    ctx.fillText(CONFIG.playerEmoji, player.x, player.y + 35);
    if (player.vy < CONFIG.jumpForce * 1.5) ctx.fillText("üî•", player.x + 5, player.y + 55);

    // --- –¢–ï–ö–°–¢–´ (–ü–ê–†–¢–ò–ö–õ–´) ---
    // –û–Ω–∏ —Ç–µ–ø–µ—Ä—å "–ø—Ä–∏–∫–ª–µ–µ–Ω—ã" –∫ —ç–∫—Ä–∞–Ω—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏, –ø–æ—ç—Ç–æ–º—É –Ω–µ –º–µ–Ω—è–µ–º –∏—Ö Y —á–µ—Ä–µ–∑ –∫–∞–º–µ—Ä—É
    for (let i = 0; i < particles.length; i++) {
        let p = particles[i];
        p.y -= 0.5; // –ú–µ–¥–ª–µ–Ω–Ω–æ –ø–ª—ã–≤—É—Ç –≤–≤–µ—Ä—Ö –ø–æ —ç–∫—Ä–∞–Ω—É
        p.life--;
        
        ctx.globalAlpha = Math.max(0, p.life / 90);
        ctx.fillStyle = "black";
        ctx.textAlign = "center";
        
        ctx.font = "24px Impact";
        ctx.fillText(p.text, p.x, p.y);
        
        if (p.subText) {
            ctx.font = "16px Impact";
            ctx.fillText(p.subText, p.x, p.y + 20);
        }
        
        ctx.textAlign = "start"; // –í–µ—Ä–Ω—É—Ç—å –∫–∞–∫ –±—ã–ª–æ
        ctx.globalAlpha = 1.0;
        if (p.life <= 0) { particles.splice(i, 1); i--; }
    }

    if (player.y > canvas.height) gameOver('fall');
    updateUI();
    requestAnimationFrame(gameLoop);
}

function getPlatformColor(type) {
    if (type === 'white') return 'white';
    if (type === 'moving') return '#90EE90';
    return '#32CD32';
}

function activateBonus(type) {
    let text = "";
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ —Ü–µ–Ω—Ç—Ä—É —ç–∫—Ä–∞–Ω–∞, —á—É—Ç—å –≤—ã—à–µ —Ü–µ–Ω—Ç—Ä–∞
    let px = canvas.width / 2;
    let py = canvas.height / 3;

    if (type === 'butter') {
        text = rndArr(CONFIG.texts.butter);
        timeScale = 0.5;
        butterTimer = 600; 
        playSound('slow');
    } else if (type === 'clap') {
        text = rndArr(CONFIG.texts.clap);
        player.clapCharges = 3;
        playSound('clap');
    } else if (type === 'sound') {
        text = rndArr(CONFIG.texts.sound);
        soundgoodizerActive = true;
        soundgoodizerTimer = 1800;
        playSound('sound');
    } else if (type === 'bass') {
        text = rndArr(CONFIG.texts.bass);
        player.vy = CONFIG.jetpackForce; 
        playSound('bass');
    } else if (type === 'ott') {
        text = rndArr(CONFIG.texts.ott);
        player.vy = CONFIG.ottForce; // –£–õ–Å–¢
        playSound('ott');
    }
    
    particles.push({x: px, y: py, text: text, subText: "", life: 150});
}

function triggerMomAttack() {
    playSound('mom');
    redScreen.style.display = 'block';
    momAlert.style.display = 'block';
    setTimeout(() => {
        redScreen.style.display = 'none';
        momAlert.style.display = 'none';
        if (gameRunning) {
            hazards.push({ x: Math.random() * (canvas.width - 40) + 20, y: -50 });
        }
    }, 1500);
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
window.addEventListener('mousemove', e => {
    let rect = canvas.getBoundingClientRect();
    inputX = e.clientX - rect.left;
});
window.addEventListener('touchmove', e => {
    e.preventDefault();
    let rect = canvas.getBoundingClientRect();
    inputX = e.touches[0].clientX - rect.left;
}, {passive: false});
window.addEventListener('touchstart', e => {
    let rect = canvas.getBoundingClientRect();
    inputX = e.touches[0].clientX - rect.left;
}, {passive: false});

clapBtn.addEventListener('click', doClap);
clapBtn.addEventListener('touchstart', (e) => { e.stopPropagation(); doClap(); });

function doClap() {
    if (gameRunning && player.clapCharges > 0) {
        player.vy = CONFIG.jumpForce; 
        player.clapCharges--;
        playSound('jump'); // –ò–ª–∏ —Å–ø–µ—Ü –∑–≤—É–∫
        updateUI();
    }
}

function updateUI() {
    scoreEl.innerText = score;
    if (player.clapCharges > 0) {
        clapBtn.style.display = 'block';
        clapCountSpan.innerText = player.clapCharges;
    } else {
        clapBtn.style.display = 'none';
    }
}

function gameOver(reason) {
    gameRunning = false;
    menuScreen.style.display = 'flex';
    gameOverDiv.style.display = 'block';
    
    // –†–∞–Ω–¥–æ–º–∏–º –º–µ–Ω—é –Ω–∞ —Å–ª–µ–¥. —Ä–∞–∑
    titleText.innerText = rndArr(CONFIG.texts.intro);
    startBtnEl.innerText = rndArr(CONFIG.texts.btnStart);

    let html = "";
    if (reason === 'fall') {
        playSound('fall');
        html = `<h2>${rndArr(CONFIG.texts.deathFallTitle)}</h2><p>${rndArr(CONFIG.texts.deathFallSub)}</p>`;
    } else if (reason === 'mom') {
        playSound('win');
        html = `<h2>${rndArr(CONFIG.texts.deathMomTitle)}</h2><p>${rndArr(CONFIG.texts.deathMomSub)}</p><p class="serif-font" style="font-size: 28px; margin-top:20px;">${CONFIG.texts.deathMomEpic}</p>`;
    }
    gameOverDiv.innerHTML = html;
}

function startGame() {
    menuScreen.style.display = 'none';
    gameOverDiv.style.display = 'none';
    initGame();
}

// –ü–µ—Ä–≤—ã–π —Ä–∞–Ω–¥–æ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
titleText.innerText = rndArr(CONFIG.texts.intro);
startBtnEl.innerText = rndArr(CONFIG.texts.btnStart);

</script>
</body>
</html>